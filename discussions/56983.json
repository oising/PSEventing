[
  {
    "Id": "192594",
    "ThreadId": "56983",
    "Html": "<p>&nbsp;</p>\r\n<p><span style=\"font-size:x-small;color:#5f9ea0;font-family:Courier New\"><span style=\"font-size:x-small;color:#5f9ea0;font-family:Courier New\"></span></span></p>\r\n<p><span style=\"font-size:x-small;color:#5f9ea0;font-family:Courier New\"><span style=\"font-size:x-small;color:#5f9ea0;font-family:Courier New\"></span></span></p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>\r\n<p><span style=\"font-size:x-small;color:#0000ff;font-family:Courier New\"><span style=\"font-size:x-small;color:#0000ff;font-family:Courier New\"><span style=\"font-size:x-small;color:#0000ff;font-family:Courier New\">I've been using PS Eventing for over a year now in our production application. We just recieved some new production systems and installed our software including ps eventing on to them and the read-event is never returning on these new systems. Just sits there forever even though the event we are watching for has fired. The new production systems are identical to the older systems with the exception of maybe a few microsoft patches. I tried to look at your code through reflector but really didn't see anything. Can you give me insight into what may cause the read-event to never return?&nbsp; The new systems are Windows 2003 Server SP2 32-bit, same as the existing systems we have.&lt;font face=&quot;Courier New&quot; size=&quot;2&quot; color=&quot;#0000ff&quot;&gt;&lt;font face=&quot;Courier New&quot; size=&quot;2&quot; color=&quot;#0000ff&quot;&gt;&lt;font face=&quot;Courier New&quot; size=&quot;2&quot; color=&quot;#0000ff&quot;&gt;\r\n<p>\r\n<p>function</p>\r\n</p>\r\n&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;</span>&lt;font face=&quot;Courier New&quot; size=&quot;2&quot; color=&quot;#0000ff&quot;&gt;&lt;font face=&quot;Courier New&quot; size=&quot;2&quot; color=&quot;#0000ff&quot;&gt;\r\n<p>\r\n<p>&nbsp;</p>\r\n</p>\r\n&lt;/font&gt;&lt;/font&gt;</span>&lt;font face=&quot;Courier New&quot; size=&quot;2&quot; color=&quot;#0000ff&quot;&gt;\r\n<p>\r\n<p>&nbsp;</p>\r\n</p>\r\n&lt;/font&gt;</span></p>\r\n<p>\r\n<p><span style=\"font-size:x-small;font-family:Courier New\"><span style=\"font-size:x-small;font-family:Courier New\"> </span></span><span style=\"font-size:x-small;color:#5f9ea0;font-family:Courier New\"><span style=\"font-size:x-small;color:#5f9ea0;font-family:Courier New\"><span style=\"font-size:x-small;color:#5f9ea0;font-family:Courier New\">DoEvents</span></span></span><span style=\"font-size:x-small;font-family:Courier New\"><span style=\"font-size:x-small;font-family:Courier New\">([</span></span><span style=\"font-size:x-small;color:#008080;font-family:Courier New\"><span style=\"font-size:x-small;color:#008080;font-family:Courier New\"><span style=\"font-size:x-small;color:#008080;font-family:Courier New\">int</span></span></span><span style=\"font-size:x-small;font-family:Courier New\"><span style=\"font-size:x-small;font-family:Courier New\">]</span></span><span style=\"font-size:x-small;color:#800080;font-family:Courier New\"><span style=\"font-size:x-small;color:#800080;font-family:Courier New\"><span style=\"font-size:x-small;color:#800080;font-family:Courier New\">$EventCount</span></span></span><span style=\"font-size:x-small;font-family:Courier New\"><span style=\"font-size:x-small;font-family:Courier New\">) {&lt;font face=&quot;Courier New&quot; size=&quot;2&quot;&gt;&lt;font face=&quot;Courier New&quot; size=&quot;2&quot;&gt;\r\n<p>&nbsp;</p>\r\n&lt;/font&gt;&lt;/font&gt;</span>&lt;font face=&quot;Courier New&quot; size=&quot;2&quot;&gt;\r\n<p>&nbsp;</p>\r\n&lt;/font&gt;</span></p>\r\n</p>\r\n<p>&nbsp;</p>\r\n<p><span style=\"font-size:x-small;color:#0000ff;font-family:Courier New\"><span style=\"font-size:x-small;color:#0000ff;font-family:Courier New\"><span style=\"font-size:x-small;color:#0000ff;font-family:Courier New\">if</span></span></span><span style=\"font-size:x-small;font-family:Courier New\"><span style=\"font-size:x-small;font-family:Courier New\"> ((</span></span><strong><span style=\"font-size:x-small;color:#5f9ea0;font-family:Courier New\"><span style=\"font-size:x-small;color:#5f9ea0;font-family:Courier New\"><span style=\"font-size:x-small;color:#5f9ea0;font-family:Courier New\">get-pssnapin</span></span></span></strong><span style=\"font-size:x-small;font-family:Courier New\"><span style=\"font-size:x-small;font-family:Courier New\"> </span></span><span style=\"font-size:x-small;color:#800000;font-family:Courier New\"><span style=\"font-size:x-small;color:#800000;font-family:Courier New\"><span style=\"font-size:x-small;color:#800000;font-family:Courier New\">pseventing</span></span></span><span style=\"font-size:x-small;font-family:Courier New\"><span style=\"font-size:x-small;font-family:Courier New\"> -ea </span></span><span style=\"font-size:x-small;color:#800000;font-family:Courier New\"><span style=\"font-size:x-small;color:#800000;font-family:Courier New\"><span style=\"font-size:x-small;color:#800000;font-family:Courier New\">silentlycontinue</span></span></span><span style=\"font-size:x-small;font-family:Courier New\"><span style=\"font-size:x-small;font-family:Courier New\">) </span></span><span style=\"font-size:x-small;color:#ff0000;font-family:Courier New\"><span style=\"font-size:x-small;color:#ff0000;font-family:Courier New\"><span style=\"font-size:x-small;color:#ff0000;font-family:Courier New\">-eq</span></span></span><span style=\"font-size:x-small;font-family:Courier New\"><span style=\"font-size:x-small;font-family:Courier New\"> </span></span><span style=\"font-size:x-small;color:#800080;font-family:Courier New\"><span style=\"font-size:x-small;color:#800080;font-family:Courier New\"><span style=\"font-size:x-small;color:#800080;font-family:Courier New\">$null</span></span></span><span style=\"font-size:x-small;font-family:Courier New\"><span style=\"font-size:x-small;font-family:Courier New\">) {</span></span><strong><span style=\"font-size:x-small;color:#5f9ea0;font-family:Courier New\"><span style=\"font-size:x-small;color:#5f9ea0;font-family:Courier New\"><span style=\"font-size:x-small;color:#5f9ea0;font-family:Courier New\">add-pssnapin</span></span></span></strong><span style=\"font-size:x-small;font-family:Courier New\"><span style=\"font-size:x-small;font-family:Courier New\"> </span></span><span style=\"font-size:x-small;color:#800000;font-family:Courier New\"><span style=\"font-size:x-small;color:#800000;font-family:Courier New\"><span style=\"font-size:x-small;color:#800000;font-family:Courier New\">pseventing</span></span></span><span style=\"font-size:x-small;font-family:Courier New\"><span style=\"font-size:x-small;font-family:Courier New\">}\r\n<p>&nbsp;</p>\r\n&lt;font face=&quot;Courier New&quot; size=&quot;2&quot;&gt;&lt;font face=&quot;Courier New&quot; size=&quot;2&quot;&gt;\r\n<p>&nbsp;</p>\r\n&lt;/font&gt;&lt;/font&gt;</span>&lt;font face=&quot;Courier New&quot; size=&quot;2&quot;&gt;\r\n<p>&nbsp;</p>\r\n&lt;/font&gt;</span></p>\r\n<p>&nbsp;</p>\r\n<p><span style=\"font-size:x-small;color:#800080;font-family:Courier New\"><span style=\"font-size:x-small;color:#800080;font-family:Courier New\"><span style=\"font-size:x-small;color:#800080;font-family:Courier New\">$InternalEventCount</span></span></span><span style=\"font-size:x-small;font-family:Courier New\"><span style=\"font-size:x-small;font-family:Courier New\"> </span></span><span style=\"font-size:x-small;color:#ff0000;font-family:Courier New\"><span style=\"font-size:x-small;color:#ff0000;font-family:Courier New\"><span style=\"font-size:x-small;color:#ff0000;font-family:Courier New\">=</span></span></span><span style=\"font-size:x-small;font-family:Courier New\"><span style=\"font-size:x-small;font-family:Courier New\"> 0;\r\n<p>&nbsp;</p>\r\n<p>start-keyhandler -capturectrlc</p>\r\n&lt;font face=&quot;Courier New&quot; size=&quot;2&quot;&gt;&lt;font face=&quot;Courier New&quot; size=&quot;2&quot;&gt;\r\n<p>&nbsp;</p>\r\n&lt;/font&gt;&lt;/font&gt;</span>&lt;font face=&quot;Courier New&quot; size=&quot;2&quot;&gt;\r\n<p>&nbsp;</p>\r\n&lt;/font&gt;</span></p>\r\n<p>&nbsp;</p>\r\n<p><span style=\"font-size:x-small;color:#0000ff;font-family:Courier New\"><span style=\"font-size:x-small;color:#0000ff;font-family:Courier New\"><span style=\"font-size:x-small;color:#0000ff;font-family:Courier New\">trap</span></span></span><span style=\"font-size:x-small;font-family:Courier New\"><span style=\"font-size:x-small;font-family:Courier New\"> { stop-keyhandler }&lt;font face=&quot;Courier New&quot; size=&quot;2&quot;&gt;&lt;font face=&quot;Courier New&quot; size=&quot;2&quot;&gt;\r\n<p>&nbsp;</p>\r\n&lt;/font&gt;&lt;/font&gt;</span>&lt;font face=&quot;Courier New&quot; size=&quot;2&quot;&gt;\r\n<p>&nbsp;</p>\r\n&lt;/font&gt;</span></p>\r\n<p>&nbsp;</p>\r\n<p><span style=\"font-size:x-small;color:#0000ff;font-family:Courier New\"><span style=\"font-size:x-small;color:#0000ff;font-family:Courier New\"><span style=\"font-size:x-small;color:#0000ff;font-family:Courier New\">do</span></span></span><span style=\"font-size:x-small;font-family:Courier New\"><span style=\"font-size:x-small;font-family:Courier New\"> {&lt;font face=&quot;Courier New&quot; size=&quot;2&quot;&gt;&lt;font face=&quot;Courier New&quot; size=&quot;2&quot;&gt;\r\n<p>&nbsp;</p>\r\n&lt;/font&gt;&lt;/font&gt;</span>&lt;font face=&quot;Courier New&quot; size=&quot;2&quot;&gt;\r\n<p>&nbsp;</p>\r\n&lt;/font&gt;</span></p>\r\n<p>&nbsp;</p>\r\n<p><span style=\"font-size:x-small;color:#800080;font-family:Courier New\"><span style=\"font-size:x-small;color:#800080;font-family:Courier New\"><span style=\"font-size:x-small;color:#800080;font-family:Courier New\">$events</span></span></span><span style=\"font-size:x-small;font-family:Courier New\"><span style=\"font-size:x-small;font-family:Courier New\"> </span></span><span style=\"font-size:x-small;color:#ff0000;font-family:Courier New\"><span style=\"font-size:x-small;color:#ff0000;font-family:Courier New\"><span style=\"font-size:x-small;color:#ff0000;font-family:Courier New\">=</span></span></span><span style=\"font-size:x-small;font-family:Courier New\"><span style=\"font-size:x-small;font-family:Courier New\"> @(read-event -wait)</span></span></p>\r\n<p>...</p>\r\n<p>}</p>\r\n<p>}</p>\r\n</p>",
    "PostedDate": "2009-05-20T16:40:44.27-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "213898",
    "ThreadId": "56983",
    "Html": "<p>Sorry Joey - I haven't been monitoring these discussions - I thought I had subscribed to alerts, but I hadn't. Are you still having a problem?</p>",
    "PostedDate": "2009-07-20T10:34:28.763-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "214032",
    "ThreadId": "56983",
    "Html": "<p>Hi, I worked with Microsoft and they helped identifiy the root problem but we are just bypassing the issue right now which is not ideal because the bypass may fail at anytime in the future. The case number is&nbsp;[REG:109061781418045].&nbsp;In your code, where you drop into IL, you are expecting all events to have the&nbsp;System.EventArgs as the last parameter. Since the majority of the APIs we work with do <span style=\"text-decoration:underline\">not</span> have System.EventArgs it is failing with a&nbsp;JIT error when your assembly is compiled in Release mode. We could add this as the last parameter to our events but it would be a lot of work and ultimately does not make for a clean API. Plus we use some API's that we don't have source code for so its not an option with those.&nbsp;I found the only workaround which is to compile the PS Eventing assembly in Debug mode and somehow this doesn't cause JIT to bomb even though your code is explicity looking for System.EventArgs.</p>\r\n<p>I'm not an IL expert. Is there any way to re-write it so that the last argument of an event does not have to be System.EventArgs?</p>\r\n<p>&nbsp;</p>\r\n<p><span style=\"text-decoration:underline\">The Microsoft Case Rep sent this:</span> (The yellow highlighted lines are what he recommended we add to our events signatures)<span style=\"font-size:x-small;color:#008000\"><span style=\"font-size:x-small;color:#008000\">\r\n<p><span style=\"color:#1f497d\"><span style=\"font-size:small\"><span style=\"font-family:Calibri\">The PSEVENting API is expecting another argument in the event handler which is of type System.EvenArgs. But in the testAPI, this argument is not passed to the event handler. </span></span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"color:#1f497d\"><span style=\"font-size:small;font-family:Calibri\">&nbsp;</span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"font-family:Calibri\"><span style=\"color:#1f497d\"><span style=\"font-size:small\">As this is running with &ldquo;Full Trust&rdquo; ILVerficiation is not done at the load time. </span></span><span style=\"font-size:10pt\"><span style=\"color:#000000\">Because the verifier didn't run, you didn't get a verification exception.&nbsp; Instead you got InvalidProgramException because the IL is *bad*.&nbsp;</span></span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"font-size:10pt\"><span style=\"color:#000000;font-family:Calibri\">&nbsp;</span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"color:#1f497d\"><span style=\"font-size:small\"><span style=\"font-family:Calibri\">To make things work, please pass another argument of type System.EvenArgs to the event handler. Example below:</span></span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"color:#1f497d\"><span style=\"font-size:small;font-family:Calibri\">&nbsp;</span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"color:#1f497d\"><span style=\"font-size:small\"><span style=\"font-family:Calibri\">In the file Step.cs:</span></span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"color:#1f497d\"><span style=\"font-size:small;font-family:Calibri\">&nbsp;</span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"font-size:10pt;color:gray;font-family:'Courier New'\">&nbsp;&nbsp;&nbsp; //</span><span style=\"font-size:10pt;color:green;font-family:'Courier New'\"> </span><span style=\"font-size:10pt;color:gray;font-family:'Courier New'\">&lt;summary&gt;</span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\"><span style=\"color:#000000\">&nbsp;&nbsp;&nbsp; </span><span style=\"color:gray\">///</span><span style=\"color:green\"> Step completed event handler</span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\"><span style=\"color:#000000\">&nbsp;&nbsp;&nbsp; </span><span style=\"color:gray\">///</span><span style=\"color:green\"> </span><span style=\"color:gray\">&lt;/summary&gt;</span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\"><span style=\"color:#000000\">&nbsp;&nbsp;&nbsp; </span><span style=\"color:blue\">public</span><span style=\"color:#000000\"> </span><span style=\"color:blue\">delegate</span><span style=\"color:#000000\"> </span><span style=\"color:blue\">void</span><span style=\"color:#000000\"> </span><span style=\"color:#2b91af\">StepCompletedEventHandler</span><span style=\"color:#000000\">(</span><span style=\"color:#2b91af\">Step</span><span style=\"color:#000000\"> step, </span><span style=\"background:yellow\"><span style=\"color:#000000\">System.</span><span style=\"color:#2b91af\">EventArgs</span><span style=\"color:#000000\"> arg</span></span><span style=\"color:#000000\">);</span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"color:#1f497d\"><span style=\"font-size:small;font-family:Calibri\">&nbsp;</span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"color:#1f497d\"><span style=\"font-size:small\"><span style=\"font-family:Calibri\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;snip&gt;</span></span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"color:#1f497d\"><span style=\"font-size:small;font-family:Calibri\">&nbsp;</span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"color:#1f497d\"><span style=\"font-size:small\"><span style=\"font-family:Calibri\">Raise the event like this:</span></span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\"><span style=\"color:#000000\">&nbsp;</span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\"><span style=\"color:#000000\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style=\"color:blue\">if</span><span style=\"color:#000000\"> (StepCompleted != </span><span style=\"color:blue\">null</span><span style=\"color:#000000\">)</span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\"><span style=\"color:#000000\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\"><span style=\"color:#000000\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style=\"color:green\">//StepCompleted.GetInvocationList();</span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\"><span style=\"color:#000000\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; StepCompleted(</span><span style=\"color:blue\">this</span><span style=\"color:#000000\">, </span><span style=\"background:yellow;color:blue\">null</span><span style=\"color:#000000\">); // &lt;- Passed another argument null. </span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"font-size:10pt;font-family:'Courier New'\"><span style=\"color:#000000\">&nbsp;</span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"color:#000000\"><span style=\"font-size:10pt;font-family:'Courier New'\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</span><span style=\"color:#1f497d\"></span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"color:#1f497d\"><span style=\"font-size:small;font-family:Calibri\">&nbsp;</span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"color:#1f497d\"><span style=\"font-size:small\"><span style=\"font-family:Calibri\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;snip&gt;</span></span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"color:#1f497d\"><span style=\"font-size:small;font-family:Calibri\">&nbsp;</span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"color:#1f497d\"><span style=\"font-size:small;font-family:Calibri\">&nbsp;</span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"color:#1f497d\"><span style=\"font-size:small\"><span style=\"font-family:Calibri\">This resolves the issue. </span></span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"color:#1f497d\"><span style=\"font-size:small\"><span style=\"font-family:Calibri\"></span></span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><span style=\"color:#1f497d\"><span style=\"font-size:small\"><span style=\"font-family:Calibri\">Thanks,</span></span></span></p>\r\n<p style=\"margin:0in 0in 0pt\"><strong><span style=\"font-size:10pt;color:blue;font-family:'Verdana','sans-serif'\">Ravi Kumar</span></strong></p>\r\n<p>&nbsp;</p>\r\n</span></span></p>",
    "PostedDate": "2009-07-20T15:19:00.937-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "214093",
    "ThreadId": "56983",
    "Html": "<p>Hi Joe,</p>\r\n<p>That's pretty odd for your API's events to not follow the standard delegate signature for events. However, please provide the delegate signatures you are working with and what you would expect from PSEventing and I'll see what I can whip up to help you. Please give me as much detail as you can.</p>\r\n<p>Also, I'm not sure what you mean it would not be a clean api. sender, args is the de-facto .NET pattern for event delegates. If you do not use EventArgs, pass EventArgs.Empty. <span style=\"text-decoration:line-through\">I think you're in for a nasty surprise if you expect powershell v2.0's built-in eventing to solve your problems; I'm pretty sure it expects the same, standard, signature too.</span> updated: native v2.0 eventing works fine with non-standard event delegates, so ignore that one.</p>\r\n<p>-Oisin</p>",
    "PostedDate": "2009-07-20T19:14:37.807-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]